<table id="admins_data"></table>  



<script>
	var obj;
	var editRow=undefined; //记录当前正在被编辑的行
	var currentOp;
	var flag;

    obj=$('#admins_data').datagrid({  
    url:'/admin/findAll',  
    queryParams:{op:'findAmdinsByPage'}, //请求远程服务器数据时候, 并且发送的额外的参数.
	fitColumns:true,//true将自动扩展/收缩columns大小适应grid的宽度,防止水平滚动.
	striped:true,//显示条纹所在行
	loadMsg:"数据加载中...",//当从远程服务器加载数据的时候,显示的提示消息.
	pagination:true,//分页
	fit:true,//满屏
	pageNumber:1,//初始页码
	pageSize:10,//分页大小
	pageList:[5,10,20,30,40,50],//设置属性
	sortName:'aid',//定义那个列可以排序.
	remoteSort:false,//定义是否远程排序.对数据库进行操作
    columns:[[ 
		{field:'aids',title:'',width:60,align:'center',checkbox:true}, 
        {field:'aid',title:'管理员编号',width:80,align:'center',sortable:true},  
        {field:'aname',title:'管理员名称',width:80,align:'center',editor:{type:"text",options:{requires:true}}},
        {field:'email',title:'管理员邮箱',width:80,align:'center',editor:{type:"text",options:{requires:true}}},

    ]],
    toolbar:[{
		text:"添加",
		iconCls:"icon-add",
		handler:function(){
			currentOp="addAdmin";
			flag="添加";
			if(editRow !=undefined){
				obj.datagrid("rejectChanges"); //回滚所有的数据
				obj.datagrid("endEdit",editRow); //关闭正在被编辑的行
				editRow=undefined;
			}else{
				obj.datagrid("insertRow",{index:0,row:{}}); 
				obj.datagrid("beginEdit",0);
				editRow=0;  //记录当前被编辑的行
			} 
		}
	},{
		text:"修改",
		iconCls:"icon-edit",
		handler:function(){
			currentOp="updateAdmin";
			flag="修改";
			var rows=obj.datagrid("getChecked")[0];
			if(rows!=undefined){
				if(editRow !=undefined){
					obj.datagrid("rejectChanges"); //回滚所有的数据
					obj.datagrid("endEdit",editRow); //关闭正在被编辑的行
					editRow=undefined;
				}else{
					//获取用户选中的行的索引
					var index=obj.datagrid("getRowIndex",rows);
					console.info(rows);
					obj.datagrid("updateRow",{index:index,row:rows}); 
					obj.datagrid("beginEdit",index);
					editRow=index;  //记录当前被编辑的行
					
				}
			}else{
				$.messager.show({
					title:'成功提示',
					msg:'请选中您要修改的数据...',
					timeout:2000,
					showType:'slide'
				});
			}
		  }
	},{
		text:"删除",
		iconCls:"icon-remove",
		handler:function(){
			var rows=obj.datagrid("getChecked");
			console.info(rows);
			if(rows!=undefined){
				$.messager.confirm('信息确认','您确认要删除选定的数据吗？',function(rs){
					if(rs){
						var aids="";
						for(var i=0;i<rows.length-1;i++){
							aids+=rows[i].aid+",";
						}
						aids+=rows[i].aid;
						//发请求到数据库删除
						$.post("/admin/deleteAdmin",{op:"delAdmin",aid:aids},function(data){
							if(data>0){
								$.messager.show({
									title:'成功提示',
									msg:'管理员删除成功',
									timeout:2000,
									showType:'slide'
								});
								rows=null;
								obj.datagrid("reload");//刷新表格
								$('#types_data').datagrid("reload");
							}else{	
								$.messager.alert('失败提示','管理员删除失败','error');
							}
						});
					}else{
						return;
					}
				});
			}else{
				$.messager.show({
					title:'成功提示',
					msg:'请选中您要删除的数据...',
					timeout:2000,
					showType:'slide'
				});
			}
		}
	},{
		text:"保存",
		iconCls:"icon-save",
		handler:function(){
			obj.datagrid("endEdit",editRow); //关闭正在被编辑的行
	
			//获取正在编辑的数据
			var rows=obj.datagrid("getChanges")[0];
			 if(rows ==undefined){   //说明没有被保存到数据库
				obj.datagrid("rejectChanges"); //回滚所有的数据
				obj.datagrid("endEdit",editRow); //关闭正在被编辑的行
				editRow=undefined;
			}else if(rows.tname==""){
				editRow=undefined;
				obj.datagrid("rejectChanges");
			}else{
				//保存到数据库
				rows["op"]=currentOp;
				
				$.post("/admin/"+currentOp,rows,function(data){
					if(data>0){
						$.messager.show({
							title:'成功提示',
							msg:'新闻类型操作成功',
							timeout:2000,
							showType:'slide'
						});
						
						rows=null;
						obj.datagrid("reload"); 
						editRow=undefined;
						obj.datagrid("rejectChanges");
						obj.datagrid("endEdit",editRow);
					}else{
						$.messager.alert('失败提示','新闻类型操作失败','error');
					}
				});
				
			}

		}
	},{
		text:"撤销",
		iconCls:"icon-redo",
		handler:function(){
			obj.datagrid("rejectChanges"); //回滚所有的数据
			obj.datagrid("endEdit",editRow); //关闭正在被编辑的行
			editRow=undefined;
		}
	}
	]
}); 
</script>